{% extends 'base.html' %}

{% block title %}–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-success mb-2">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
            <p class="text-muted">–õ–∏—á–Ω—ã–µ –∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</p>
        </div>
        <div class="d-flex gap-2">
            <a href="{% url 'upload_documents' %}" class="btn btn-custom text-white">
                üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã
            </a>
            <a href="{% url 'profile_edit' %}" class="btn btn-outline-success">
                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </a>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
    <div class="form-card p-4 mb-5">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h4 class="fw-bold mb-2">üìÑ –°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h4>
                <p class="mb-0">
                    –°—Ç–∞—Ç—É—Å:
                    <span class="badge
                        {% if profile.document_status == 'verified' %}bg-success
                        {% elif profile.document_status == 'pending' %}bg-warning
                        {% elif profile.document_status == 'rejected' %}bg-danger
                        {% else %}bg-secondary{% endif %}">
                        {{ profile.get_document_status_display }}
                    </span>
                </p>
                {% if profile.document_status == 'verified' %}
                    <small class="text-muted">
                        –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã {{ profile.document_verified_at|date:"d.m.Y" }}
                    </small>
                {% endif %}
            </div>
            <div>
                {% if profile.document_status == 'verified' %}
                    <span class="text-success">‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∑–∞—Å–µ–ª–µ–Ω–∏—é</span>
                {% else %}
                    <a href="{% url 'upload_documents' %}" class="btn btn-sm btn-custom text-white">
                        {% if profile.document_status == 'not_uploaded' %}–ó–∞–≥—Ä—É–∑–∏—Ç—å{% else %}–û–±–Ω–æ–≤–∏—Ç—å{% endif %} –¥–æ–∫—É–º–µ–Ω—Ç—ã
                    </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è -->
    <div class="form-card p-4 mb-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold text-dark mb-0">–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h5>
            <span class="badge bg-{% if profile_completion >= 70 %}success{% else %}warning{% endif %}">
                {{ profile_completion|floatformat:0 }}%
            </span>
        </div>
        <div class="progress" style="height: 10px;">
            <div class="progress-bar bg-success" role="progressbar"
                 style="width: {{ profile_completion }}%"
                 aria-valuenow="{{ profile_completion }}"
                 aria-valuemin="0"
                 aria-valuemax="100">
            </div>
        </div>
        <small class="text-muted mt-2 d-block">
            {% if profile_completion < 70 %}
                –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –¥–æ 70% –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –±—Ä–æ–Ω–∏
            {% else %}
                –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–ø–æ–ª–Ω–µ–Ω –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            {% endif %}
        </small>
    </div>

    <div class="row g-4">
        <!-- –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
        <div class="col-lg-6">
            <div class="form-card p-4 h-100">
                <h4 class="fw-bold text-success mb-4">
                    <i class="bi bi-person me-2"></i>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                </h4>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–§–ò–û:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>{{ profile.full_name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>
                            {% if profile.birth_date %}
                                {{ profile.birth_date|date:"d.m.Y" }} ({{ profile.age }} –ª–µ—Ç)
                            {% else %}
                                –ù–µ —É–∫–∞–∑–∞–Ω–∞
                            {% endif %}
                        </p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–ü–æ–ª:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>{{ profile.get_gender_display|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>{{ profile.phone|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>Email:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>{{ profile.email|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–ê–¥—Ä–µ—Å:</strong></p>
                    </div>
                    <div class="col-md-6">
                        <p>{{ profile.address|default:"–ù–µ —É–∫–∞–∑–∞–Ω"|linebreaksbr }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ú–ê–°–ö–ò–†–û–í–ê–ù–ù–´–ï) -->
        <div class="col-lg-6">
            <div class="form-card p-4 h-100">
                <h4 class="fw-bold text-success mb-4">
                    <i class="bi bi-shield-check me-2"></i>–î–æ–∫—É–º–µ–Ω—Ç—ã
                </h4>

                <!-- –ü–∞—Å–ø–æ—Ä—Ç -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–ü–∞—Å–ø–æ—Ä—Ç:</strong></p>
                    </div>
                    <div class="col-md-6">
                        {% if profile.passport_masked %}
                            <p>{{ profile.passport_masked }}
                                {% if profile.document_status == 'verified' %}
                                    <span class="badge bg-success bg-opacity-25 text-success ms-2">‚úì</span>
                                {% endif %}
                            </p>
                        {% else %}
                            <p class="text-muted">–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω</p>
                        {% endif %}
                    </div>
                </div>

                <!-- –°–ù–ò–õ–° -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–°–ù–ò–õ–°:</strong></p>
                    </div>
                    <div class="col-md-6">
                        {% if profile.snils_masked %}
                            <p>{{ profile.snils_masked }}
                                {% if profile.document_status == 'verified' %}
                                    <span class="badge bg-success bg-opacity-25 text-success ms-2">‚úì</span>
                                {% endif %}
                            </p>
                        {% else %}
                            <p class="text-muted">–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω</p>
                        {% endif %}
                    </div>
                </div>

                <!-- –ü–æ–ª–∏—Å –û–ú–° -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–ü–æ–ª–∏—Å –û–ú–°:</strong></p>
                    </div>
                    <div class="col-md-6">
                        {% if profile.document_status == 'verified' %}
                            <p class="text-success">‚úÖ –ù–∞–ª–∏—á–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</p>
                        {% else %}
                            <p class="text-muted">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞</p>
                        {% endif %}
                    </div>
                </div>

                <!-- –ú–µ–¥. –∫–Ω–∏–∂–∫–∞ -->
                <div class="row">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–ú–µ–¥. –∫–Ω–∏–∂–∫–∞:</strong></p>
                    </div>
                    <div class="col-md-6">
                        {% if profile.document_status == 'verified' %}
                            <p class="text-success">‚úÖ –ù–∞–ª–∏—á–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</p>
                        {% else %}
                            <p class="text-muted">–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞</p>
                        {% endif %}
                    </div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
{% if profile.document_status != 'verified' %}
<div class="mt-4 pt-3 border-top">
    <a href="{% url 'upload_documents' %}" class="btn btn-custom w-100 text-white">
        üì§ {% if profile.document_status == 'not_uploaded' %}–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã{% else %}–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã{% endif %}
    </a>
</div>
{% endif %}
            </div>
        </div>

        <!-- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="col-12">
            <div class="form-card p-4">
                <h4 class="fw-bold text-success mb-4">
                    <i class="bi bi-heart-pulse me-2"></i>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                </h4>

                <div class="row g-4">
                    <div class="col-md-4">
                        <p class="mb-2"><strong>–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏:</strong></p>
                        <p>{{ profile.get_blood_type_display|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</p>
                    </div>

                    <div class="col-md-4">
                        <p class="mb-2"><strong>–ü–∏—Ç–∞–Ω–∏–µ:</strong></p>
                        <p>{{ profile.get_preferred_diet_display|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
                    </div>

                    <div class="col-md-4">
                        <p class="mb-2"><strong>–¢—Ä–∞–Ω—Å—Ñ–µ—Ä:</strong></p>
                        <p>{{ profile.need_transfer|yesno:"–ù—É–∂–µ–Ω,–ù–µ –Ω—É–∂–µ–Ω" }}</p>
                    </div>

                    <div class="col-md-6">
                        <p class="mb-2"><strong>–•—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è:</strong></p>
                        <p>{{ profile.chronic_diseases|default:"–ù–µ —É–∫–∞–∑–∞–Ω—ã"|linebreaksbr }}</p>
                    </div>

                    <div class="col-md-6">
                        <p class="mb-2"><strong>–ê–ª–ª–µ—Ä–≥–∏–∏:</strong></p>
                        <p>{{ profile.allergies|default:"–ù–µ —É–∫–∞–∑–∞–Ω—ã"|linebreaksbr }}</p>
                    </div>

                    <div class="col-md-6">
                        <p class="mb-2"><strong>–õ–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –Ω–µ–ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å:</strong></p>
                        <p>{{ profile.drug_intolerance|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞"|linebreaksbr }}</p>
                    </div>

                    <div class="col-md-6">
                        <p class="mb-2"><strong>–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è:</strong></p>
                        <p>{{ profile.contraindications|default:"–ù–µ —É–∫–∞–∑–∞–Ω—ã"|linebreaksbr }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="col-12">
            <div class="form-card p-4">
                <h4 class="fw-bold text-success mb-4">
                    <i class="bi bi-info-circle me-2"></i>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                </h4>

                <div class="row g-4">
                    <div class="col-md-6">
                        <p class="mb-2"><strong>–û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è:</strong></p>
                        <p>{{ profile.special_requests|default:"–ù–µ—Ç"|linebreaksbr }}</p>
                    </div>

                    <div class="col-md-6">
                        <p class="mb-2"><strong>–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç:</strong></p>
                        <p>
                            {% if profile.emergency_contact and profile.emergency_phone %}
                                {{ profile.emergency_contact }} ({{ profile.emergency_phone }})
                            {% else %}
                                –ù–µ —É–∫–∞–∑–∞–Ω
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}